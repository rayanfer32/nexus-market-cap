#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

changed_files="$(git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD)"

echo "..."

#  function  to check package.json and yarn.lock file changes
check_package_json_and_yarn_lock() {
  echo "ğŸ•µï¸ğŸ“¦ Checking package file changes..."
  if [ -n "$changed_files" ]; then
    if [ -n "$(echo "$changed_files" | grep package.json)" ]; then
      echo "ğŸ“¦ package.json file changed"
      yarn install
    fi
    if [ -n "$(echo "$changed_files" | grep yarn.lock)" ]; then
      echo "ğŸ“¦ yarn.lock file changed"
      yarn install
    fi
  fi
}
  
if [ -z "$changed_files" ]; then
  echo "ğŸ¤·â€â™‚ï¸ No files changed"
  exit 0
fi

# run check_package_json_and_yarn_lock function 
check_package_json_and_yarn_lock || (
  echo "âŒ changes in packages checks failed"
  exit 1
)

echo "âœ… No package or yarn.lock file changes found"